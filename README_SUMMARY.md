# Repository Summary: Multi-Agent System for EBR Unified Development Code

This repository hosts a production-ready, multi-agent assistant designed to interact with the East Baton Rouge (EBR) Unified Development Code. It is built upon the OpenAI `gpc_agents` SDK and incorporates advanced features such as tracing, guardrails, cost governance, and observability tooling.

## System Architecture and Features

The system employs a sophisticated multi-agent architecture to process user queries and provide accurate information.

### Runtime Flow

1.  **ORCHESTRATOR Agent**: Receives the initial user prompt and intelligently hands it off to the most appropriate specialist agent.
2.  **Guardrails**: Before any Language Model (LLM) invocation, pre-processing guardrails are applied to check for profanity, filter Personally Identifiable Information (PII), and enforce length limits on inputs.
3.  **Specialist Agent Execution**: The selected specialist agent utilizes a suite of built-in tools (detailed below) to gather information and formulate an answer.
4.  **LLM Judge**: A dedicated LLM Judge scores the final answer on a scale of 1 to 5 and provides a rationale for its assessment. This evaluation is persisted for each interaction.
5.  **Cost Management**: Token usage is meticulously logged, and a budget breaker mechanism automatically aborts operations if the configured 24-hour spending limit is surpassed.

### Key Features

*   **Tracing**: Enables detailed tracking of requests and agent interactions for debugging and analysis.
*   **Guardrails**: Ensures input and output quality and safety.
*   **Cost Governance**: Provides mechanisms to monitor and control OpenAI API expenses.
*   **Observability**: Offers insights into system performance and behavior through tools like OpenTelemetry and Prometheus metrics (e.g., Redis cache hit/miss counters).
*   **LLM Judge**: Assesses and records the quality of answers generated by the system.

### Interfaces

The system provides multiple interfaces for interaction:

*   **CLI (Command Line Interface)**: Allows direct interaction via `python -m agents.master_orchestrator_agent "Your question"`.
*   **FastAPI**: An API endpoint (`POST /ask`) for programmatic access, returning the answer and a `run_result_path`.
*   **Flask (Legacy)**: An older web interface (`ebr_zoning_web.py`), with plans to migrate to a FastAPI-based UI.
*   **Metrics**: Exposes a `/metrics` endpoint for Prometheus to scrape operational data.

## Specialist Agents

There are **11 specialist agents**, each expert in different parts of the EBR Unified Development Code. New specialists can be easily added using the `agents/specialist_builder.py` script.

### Covered Domains:

*   Chapters 8-9: Districts & Uses
*   Chapter 3: Processes
*   Chapter 17: Parking
*   Chapter 11: Dimensional standards
*   Section 10.3: Historic districts
*   Chapter 15: Environmental regulations
*   Chapter 16: Signage
*   Chapter 7: Non-conformities
*   Chapters 14 & 18: Landscape and tree protection
*   Chapter 19: Definitions
*   Chapters 2, 5, & 6: Administration and enforcement
*   Chapter 4: Site Plans and development review

## Built-in Tools

The agents have access to a variety of powerful tools to perform their tasks:

*   **FileSearchTool**: Conducts hybrid searches (BM25 + embedding reranker) scoped to specific chapters of the development code.
*   **CodeInterpreterTool**: Executes Python 3.11 code in a sandboxed environment for numerical calculations (e.g., Floor Area Ratios, parking ratios).
*   **WebSearchTool**: Looks up state-level regulations, particularly for Louisiana (US-LA).
*   **HostedMCPTool**: Interacts with a remote permit/GIS micro-service (activated if `MCP_PERMIT_URL` is set).
*   **get_parcel_zoning**: Retrieves parcel zoning information via a GIS REST lookup, with results cached for 1 hour (Redis/in-process).
*   **log_qa**: Logs questions and answers to an encrypted SQLite database (requires `FERNET_KEY`).
